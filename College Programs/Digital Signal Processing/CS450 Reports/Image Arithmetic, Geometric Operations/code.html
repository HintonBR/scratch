<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
	<title>Source Code</title>
</head>

<body bgcolor="#CCCCCC" text="#006633" link="#FFFF00">
<table border="5" bordercolor="#008040" align="center">
<caption align="center"><h2>Source Code</h2></caption>
<tr><td align="left"><pre><code>
/*
 * ImageDisplay.java
 *
 * Created on January 22, 2001, 10:35 PM
 */


/**
 *
 * @author  Bryan
 * @version 
 */

import jigl.image.io.*;
import jigl.image.*;
import jigl.gui.*;
import jigl.signal.*;
import jigl.signal.io.*;
import javax.swing.*;
import java.awt.*;
import jigl.signal.ops.*;
import jigl.image.ops.*;
import java.lang.*;
public class ImageDisplay extends javax.swing.JFrame {

    

    private GrayImage grayImage2;
    private GrayImage  grayImage;
    private GrayImage  subGrayImage;
    private JImageCanvas canvas1;
    private JImageCanvas canvas2;
    private JImageCanvas canvas3;
    private SignalCanvas sgCanvas;
    private Histogram hgImage;
    private RealSignal rsSignal;
    
    /** Creates new form ColorGray */
    public ImageDisplay() {
        initComponents ();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the FormEditor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        jMenuBar1 = new javax.swing.JMenuBar();
        jMenu1 = new javax.swing.JMenu();
        jMenuItem1 = new javax.swing.JMenuItem();
        jMenuItem2 = new javax.swing.JMenuItem();
        jMenuItem3 = new javax.swing.JMenuItem();
        jLabel2 = new javax.swing.JLabel();
        jPanel1 = new javax.swing.JPanel();
        jPanel2 = new javax.swing.JPanel();
        scrollPane1 = new java.awt.ScrollPane();
        jPanel6 = new javax.swing.JPanel();
        scrollPane2 = new java.awt.ScrollPane();
        jPanel7 = new javax.swing.JPanel();
        scrollPane3 = new java.awt.ScrollPane();
        jPanel4 = new javax.swing.JPanel();
        cmdInitiate = new javax.swing.JButton();
        jPanel5 = new javax.swing.JPanel();
        cmdRotate120 = new javax.swing.JButton();
        cmdRotateImage15 = new javax.swing.JButton();
        
        jMenu1.setText("Actions");
          
          jMenuItem1.setText("Reset Image 3");
            jMenuItem1.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    jMenuItem1ActionPerformed(evt);
                }
            }
            );
            jMenu1.add(jMenuItem1);
            
          jMenuItem2.setText("Write Histogram of Image 3 to File");
            jMenuItem2.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    jMenuItem2ActionPerformed(evt);
                }
            }
            );
            jMenu1.add(jMenuItem2);
            
          jMenuItem3.setText("Write Images to File");
            jMenuItem3.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    jMenuItem3ActionPerformed(evt);
                }
            }
            );
            jMenu1.add(jMenuItem3);
            jMenuBar1.add(jMenu1);
          setTitle("Imaging Display");
        setForeground(java.awt.Color.white);
        setBackground(java.awt.Color.white);
        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        addComponentListener(new java.awt.event.ComponentAdapter() {
            public void componentResized(java.awt.event.ComponentEvent evt) {
                formComponentResized(evt);
            }
        }
        );
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                exitForm(evt);
            }
        }
        );
        
        jLabel2.setBorder(new javax.swing.border.BevelBorder(1, java.awt.Color.white, java.awt.Color.white, java.awt.Color.darkGray,
        java.awt.Color.black));
        jLabel2.setText("Imaging Display");
        jLabel2.setForeground(java.awt.Color.black);
        jLabel2.setBackground(new java.awt.Color (204, 204, 255));
        jLabel2.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel2.setFont(new java.awt.Font ("Garamond", 0, 36));
        jLabel2.setOpaque(true);
        jLabel2.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        
        getContentPane().add(jLabel2, java.awt.BorderLayout.NORTH);
        
        
        jPanel1.setLayout(new java.awt.GridLayout(1, 3));
        jPanel1.setBorder(new javax.swing.border.TitledBorder("Image Display"));
        
        jPanel2.setLayout(new java.awt.GridLayout(1, 1));
          jPanel2.setBorder(new javax.swing.border.TitledBorder("Image 1"));
          
          scrollPane1.setFont(new java.awt.Font ("Dialog", 0, 11));
            scrollPane1.setName("scrollpane4");
            scrollPane1.setBackground(new java.awt.Color (204, 204, 204));
            scrollPane1.setForeground(java.awt.Color.black);
            jPanel2.add(scrollPane1);
            
            jPanel1.add(jPanel2);
          
          
        jPanel6.setLayout(new java.awt.GridLayout(1, 1));
          jPanel6.setBorder(new javax.swing.border.TitledBorder("Image 2"));
          
          scrollPane2.setFont(new java.awt.Font ("Dialog", 0, 11));
            scrollPane2.setBackground(new java.awt.Color (204, 204, 204));
            scrollPane2.setForeground(java.awt.Color.black);
            jPanel6.add(scrollPane2);
            
            jPanel1.add(jPanel6);
          
          
        jPanel7.setLayout(new java.awt.GridLayout(1, 1));
          jPanel7.setBorder(new javax.swing.border.TitledBorder("Image 3"));
          
          scrollPane3.setFont(new java.awt.Font ("Dialog", 0, 11));
            scrollPane3.setBackground(java.awt.Color.lightGray);
            scrollPane3.setForeground(java.awt.Color.black);
            jPanel7.add(scrollPane3);
            
            jPanel1.add(jPanel7);
          
          
        getContentPane().add(jPanel1, java.awt.BorderLayout.CENTER);
        
        
        jPanel4.setLayout(new java.awt.GridLayout(2, 1));
        
        cmdInitiate.setBorder(new javax.swing.border.BevelBorder(0));
          cmdInitiate.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
          cmdInitiate.setName("cmdIntiatiate");
          cmdInitiate.setFont(new java.awt.Font ("Garamond", 1, 18));
          cmdInitiate.setText("Center of Gravity");
          cmdInitiate.addActionListener(new java.awt.event.ActionListener() {
              public void actionPerformed(java.awt.event.ActionEvent evt) {
                  cmdInitiateActionPerformed(evt);
              }
          }
          );
          jPanel4.add(cmdInitiate);
          
          
        jPanel5.setLayout(new java.awt.GridLayout(1, 2));
          
          cmdRotate120.setBorder(new javax.swing.border.BevelBorder(0));
            cmdRotate120.setFont(new java.awt.Font ("Garamond", 1, 18));
            cmdRotate120.setText("Rotate Image 120 degrees");
            cmdRotate120.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    cmdRotate120ActionPerformed(evt);
                }
            }
            );
            jPanel5.add(cmdRotate120);
            
            
          cmdRotateImage15.setBorder(new javax.swing.border.BevelBorder(0));
            cmdRotateImage15.setFont(new java.awt.Font ("Garamond", 1, 18));
            cmdRotateImage15.setText("Rotate Image 120 Degrees (In 15 degree increments)");
            cmdRotateImage15.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    cmdRotateImage15ActionPerformed(evt);
                }
            }
            );
            jPanel5.add(cmdRotateImage15);
            
            jPanel4.add(jPanel5);
          
          
        getContentPane().add(jPanel4, java.awt.BorderLayout.SOUTH);
        
        setJMenuBar(jMenuBar1);
        
        pack();
        java.awt.Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();
        java.awt.Dimension dialogSize = getSize();
        setSize(new java.awt.Dimension(1080, 661));
        setLocation((screenSize.width-1080)/2,(screenSize.height-661)/2);
    }//GEN-END:initComponents

  private void jMenuItem2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem2ActionPerformed
    createHistogram(subGrayImage, hgImage);
    writeToFile(rsSignal, "C:\\SubtractHistogram.dat");
  }//GEN-LAST:event_jMenuItem2ActionPerformed

  private void jMenuItem1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem1ActionPerformed
    try {
        subGrayImage = new GrayImage(grayImage.getData());
        scrollPane3.add(canvas3 = new JImageCanvas(subGrayImage));
        scrollPane3.validate();
        scrollPane3.repaint();
    }
    catch (Exception e) {}
  }//GEN-LAST:event_jMenuItem1ActionPerformed

  private void jMenuItem3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem3ActionPerformed
    writeToFile(grayImage, "C:\\Image1.pgm");
    writeToFile(grayImage2, "C:\\Image2.pgm");
    writeToFile(subGrayImage, "C:\\Image3.pgm");
  }//GEN-LAST:event_jMenuItem3ActionPerformed

  //Perform a rotation on an image by degree degrees
  private void rotateImage(GrayImage testImage, int degree) {
    int i, j, centerx, centery;
    double tempY, tempX;
    GrayImage result = new GrayImage(testImage.X(), testImage.Y());
    centerx = testImage.X() /2;
    centery = testImage.Y() /2;

    //Loop through the new image and perform backwards mapping
    for (i=0;i<testImage.X(); i++) {
        for (j=0;j<testImage.Y(); j++) {
            //Equations that does the backward mapping algorithm
            tempY = (j-centery) * Math.cos(-(degree * 2 * Math.PI)/360) - (i-centerx) * Math.sin(-(degree * 2 * Math.PI)/360) + centery;
            tempX = (j-centery) * Math.sin(-(degree * 2 * Math.PI)/360) + (i-centerx) * Math.cos(-(degree * 2 * Math.PI)/360) + centerx;
            
            //Translates the image to the origin (Cartesain origin - lower lefthand corner)
            //tempY = j - centery;
            //tempX = i + centerx;
            
            //Functions that find x and y values so that we can do forward mapping algorithm
            //tempY = (i-centerx) * Math.sin(-(degree * 2 * Math.PI)/360) + (j-centery) * Math.cos(-(degree * 2 * Math.PI)/360) + centerx;
            //tempX = (i-centerx) * Math.cos(-(degree * 2 * Math.PI)/360) - (j-centery) * Math.sin(-(degree * 2 * Math.PI)/360) + centery;
            
            //Do range checking and if valid then set the value in the result image after interpolating the values from the old image
            if (tempY <testImage.Y()-1 && tempX < testImage.X()-1 && tempY >= 0 && tempX >= 0) result.set(i, j, interpolate(testImage, tempX, tempY));
        }
    }
    try {
        subGrayImage = new GrayImage(result.getData());
        scrollPane3.removeAll();
        scrollPane3.add(canvas3 = new JImageCanvas(subGrayImage));
        scrollPane3.validate();
        scrollPane3.repaint();
    }
    catch (Exception e) {}
  }
  
  //Function that takes an image given a set of coordinates and interpolates an integer value
  private int interpolate(GrayImage testImage, double x, double y) {
    double val;
    int zerox, zeroy, onex, oney;
    double diffx, diffy;
    zerox = (int) x;
    zeroy = (int) y;
    onex = ((int) x) + 1;
    oney = ((int) y) + 1;
    diffx = x - zerox;
    diffy = y - zeroy;
    val = (testImage.get(onex, zeroy) - testImage.get(zerox, zeroy)) * diffx + (testImage.get(zerox, oney) - testImage.get(zerox, zeroy)) * diffy + (testImage.get(onex, oney) + testImage.get(zerox, zeroy) - testImage.get(zerox, oney) - testImage.get(onex, zeroy)) * diffx * diffy + testImage.get(zerox, zeroy);
    return (int) val;
  }
  private void cmdRotateImage15ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdRotateImage15ActionPerformed
    for (int i=0; i <8; i++) rotateImage(subGrayImage, 15);
  }//GEN-LAST:event_cmdRotateImage15ActionPerformed

  //Resets the title bar showing the size everytime the form is resized
  private void formComponentResized(java.awt.event.ComponentEvent evt) {//GEN-FIRST:event_formComponentResized
    this.setTitle("CS450 Imaging Project #3 - Form size X=" + this.getWidth() + ", Y=" + this.getHeight());
    
  }//GEN-LAST:event_formComponentResized
   
  //Calls the subtract Image function, calculates the center of Gravity and then displays the result
  private void cmdInitiateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdInitiateActionPerformed
    grayImage2 = loadImage("C:\\Bryan's Files\\Programs\\Java\\Image3\\stufmin1.pgm", scrollPane2, grayImage2, canvas2);
    subGrayImage = new GrayImage(grayImage.getData());
    subGrayImage = subtractImage(grayImage, grayImage2);
    try {
        scrollPane3.add(canvas3 = new JImageCanvas(subGrayImage));
        scrollPane3.repaint();
        scrollPane3.validate();
    }
    catch (Exception e) {}
    
  }//GEN-LAST:event_cmdInitiateActionPerformed

  //Subtract the from image from the minus image and return the new Image
  private GrayImage subtractImage(GrayImage from, GrayImage minus) {
    int i, j;
    long sumx, sumy, totalx, totaly;
    sumx = 0;
    sumy = 0;
    totalx = 0;
    totaly = 0;
    GrayImage returnImage = new GrayImage(from.getData());
    for (i=0; i<from.X();i++) {
        for (j=0;j<from.Y();j++) {
            returnImage.set(i, j, from.get(i,j) - minus.get(i,j));
            if (returnImage.get(i, j) > 140 && returnImage.get(i, j) < 200) {
                sumx += i;
                totalx++;
                sumy += j;
                totaly++;
            }
        }
    }
    
    JOptionPane.showMessageDialog(null, "The center of gravity of the new image is (" + (int) sumx/totalx + ", " + (int) sumy/totaly + ")");
    return returnImage;
  }
  private void cmdRotate120ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdRotate120ActionPerformed
      rotateImage(subGrayImage, 120);
  }//GEN-LAST:event_cmdRotate120ActionPerformed

  //Create a Histogram and add it the signal Canvas
  private Histogram createHistogram(GrayImage gImage, Histogram hg) {
      RealSignal test;
      try {
            hg = new Histogram(gImage, 1);
            rsSignal = hg.toSignal();
            rsSignal.byteSize();
            if (sgCanvas == null) {
                sgCanvas = new SignalCanvas(rsSignal);
            }
            else {
                sgCanvas.setSignal(rsSignal);
            }
      }
      catch (Exception e) {
        JOptionPane.showMessageDialog(null, e.getClass().toString() + "\n" + e.getMessage());
      }
      return hg;
  }
  
  //Write an signal out to a file at the filename specified
  private void writeToFile(Signal mySignal, String filename) {
      try {
    SignalOutputStream ios = new SignalOutputStream(filename);
    ios.write(mySignal);
    ios.close();
      }
      catch (Exception e) {
        JOptionPane.showMessageDialog(null, e.getMessage());
      }
      
  }
  
  //Write an image out to a file at the filename specified
  private void writeToFile(GrayImage myImage, String filename) {
      try {
    ImageOutputStream ios = new ImageOutputStream(filename);
    ios.write(myImage);
    ios.close();
      }
      catch (Exception e) {
        JOptionPane.showMessageDialog(null, e.getMessage());
      }
      
  }
    /** Exit the Application */
    private void exitForm(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_exitForm
        System.exit (0);
    }//GEN-LAST:event_exitForm

    /**
    * loadImage - loads the image from the filename passed in and then adds it the canvas passed in and 
    * adds the canvas to the scrollPane
    */
    private GrayImage loadImage(String filename, ScrollPane location, GrayImage gImage, JImageCanvas can) {
        
        try {
            ImageInputStream ins = new ImageInputStream(filename);
            gImage = (GrayImage) ins.read();
            ins.close();
            location.add(can = new JImageCanvas(gImage));
            location.repaint();
            location.validate();
        }
        catch (Exception e) {
            if (e.getMessage() != null && e.getMessage().equals("") == false) {
                JOptionPane.showMessageDialog(null, e.getMessage());
            }
         }
         return gImage;
    }
        
    public static void main (String args[]) {
        ImageDisplay cg = new ImageDisplay ();
        
        
        //Load Initial Image
        try {
            cg.grayImage = cg.loadImage("C:\\Bryan's Files\\Programs\\Java\\Image3\\stuff.pgm", cg.scrollPane1,cg.grayImage, cg.canvas1);
            cg.grayImage2 = new GrayImage(cg.grayImage.getData());
            //cg.scrollPane1.setSize(cg.getWidth()/3, cg.getHeight() * (3/5));
            //cg.scrollPane2.setSize(cg.getWidth()/3, cg.getHeight() * (3/5));
            //cg.scrollPane3.setSize(cg.getWidth()/3, cg.getHeight() * (3/5));
        }
        catch (Exception e) {
            if (e.getMessage() != null && e.getMessage().equals("") == false) {
                JOptionPane.showMessageDialog(null, e.getMessage());
            }
         }
        cg.show();
    }


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JMenuBar jMenuBar1;
    private javax.swing.JMenu jMenu1;
    private javax.swing.JMenuItem jMenuItem1;
    private javax.swing.JMenuItem jMenuItem2;
    private javax.swing.JMenuItem jMenuItem3;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private java.awt.ScrollPane scrollPane1;
    private javax.swing.JPanel jPanel6;
    private java.awt.ScrollPane scrollPane2;
    private javax.swing.JPanel jPanel7;
    private java.awt.ScrollPane scrollPane3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JButton cmdInitiate;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JButton cmdRotate120;
    private javax.swing.JButton cmdRotateImage15;
    // End of variables declaration//GEN-END:variables

}

</code></pre></tr>
</table>



</body>
</html>
